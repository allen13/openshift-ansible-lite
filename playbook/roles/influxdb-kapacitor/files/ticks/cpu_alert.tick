stream
  |from()
    .measurement('cpu')
    .groupBy('host','dc')
  |window()
    .period(1m)
    .every(1m)
  |mean('usage_idle').as('usage_idle_mean')
  |alert()
    .info(lambda: TRUE)
    .crit(lambda: "usage_idle_mean" <  30)
    .alerta()
      .resource('{{ index .Tags "host" }}')
      .event('cpu usage idle')
      .environment('{{ index .Tags "dc" }}')
      .value('{{ index .Fields "usage_idle_mean" }}')
      .group('baremetal')
      .message('cpu usage idle')
